{"version":3,"file":"markdownItFrontMatter.mjs","sources":["../index.js"],"sourcesContent":["// Process front matter and pass to cb\n\n\nmodule.exports = function front_matter_plugin(md, opts) {\n  opts = Object.assign({}, opts);\n\n  let min_markers = 3,\n      marker_str  = '-',\n      marker_char = marker_str.charCodeAt(0),\n      marker_len  = marker_str.length;\n\n  function frontMatter(state, startLine, endLine, silent) {\n    let pos,\n        nextLine,\n        marker_count,\n        token,\n        old_parent,\n        old_line_max,\n        start_content,\n        auto_closed = false,\n        start = state.bMarks[startLine] + state.tShift[startLine],\n        max = state.eMarks[startLine];\n\n    // Check out the first character of the first line quickly,\n    // this should filter out non-front matter\n    if (startLine !== 0 || marker_char !== state.src.charCodeAt(0)) {\n      return false;\n    }\n\n    // Check out the rest of the marker string\n    // while pos <= 3\n    for (pos = start + 1; pos <= max; pos++) {\n      if (marker_str[(pos - start) % marker_len] !== state.src[pos]) {\n        start_content = pos + 1;\n        break;\n      }\n    }\n\n    marker_count = Math.floor((pos - start) / marker_len);\n\n    if (marker_count < min_markers) {\n      return false;\n    }\n    pos -= (pos - start) % marker_len;\n\n    // Since start is found, we can report success here in validation mode\n    if (silent) {\n      return true;\n    }\n\n    // Search for the end of the block\n    nextLine = startLine;\n\n    for (;;) {\n      nextLine++;\n      if (nextLine >= endLine) {\n        // unclosed block should be autoclosed by end of document.\n        // also block seems to be autoclosed by end of parent\n        break;\n      }\n\n      if (state.src.slice(start, max) === '...') {\n        break;\n      }\n\n      start = state.bMarks[nextLine] + state.tShift[nextLine];\n      max = state.eMarks[nextLine];\n\n      if (start < max && state.sCount[nextLine] < state.blkIndent) {\n        // non-empty line with negative indent should stop the list:\n        // - ```\n        //  test\n        break;\n      }\n\n      if (marker_char !== state.src.charCodeAt(start)) {\n        continue;\n      }\n\n      if (state.sCount[nextLine] - state.blkIndent >= 4) {\n        // closing fence should be indented less than 4 spaces\n        continue;\n      }\n\n      for (pos = start + 1; pos <= max; pos++) {\n        if (marker_str[(pos - start) % marker_len] !== state.src[pos]) {\n          break;\n        }\n      }\n\n      // closing code fence must be at least as long as the opening one\n      if (Math.floor((pos - start) / marker_len) < marker_count) {\n        continue;\n      }\n\n      // make sure tail has spaces only\n      pos -= (pos - start) % marker_len;\n      pos = state.skipSpaces(pos);\n\n      if (pos < max) {\n        continue;\n      }\n\n      // found!\n      auto_closed = true;\n      break;\n    }\n\n    old_parent = state.parentType;\n    old_line_max = state.lineMax;\n    state.parentType = 'container';\n\n    // this will prevent lazy continuations from ever going past our end marker\n    state.lineMax = nextLine;\n\n    token        = state.push('front_matter', null, 0);\n    token.hidden = true;\n    token.markup = state.src.slice(startLine, pos);\n    token.block  = true;\n    token.map    = [ startLine, pos ];\n    token.meta   = state.src.slice(start_content, start - 1);\n\n    state.parentType = old_parent;\n    state.lineMax = old_line_max;\n    state.line = nextLine + (auto_closed ? 1 : 0);\n\n    if (opts.callback) {\n      opts.callback.call(opts, token.meta, token, state);\n    }\n\n    return true;\n  }\n\n  md.block.ruler.before(\n    'table',\n    'front_matter',\n    frontMatter,\n    {\n      alt: [\n        'paragraph',\n        'reference',\n        'blockquote',\n        'list'\n      ]\n    }\n  );\n};\n"],"names":["module","exports","front_matter_plugin","md","opts","Object","assign","min_markers","marker_str","marker_char","charCodeAt","marker_len","length","frontMatter","state","startLine","endLine","silent","pos","nextLine","marker_count","token","old_parent","old_line_max","start_content","auto_closed","start","bMarks","tShift","max","eMarks","src","Math","floor","slice","sCount","blkIndent","skipSpaces","parentType","lineMax","push","hidden","markup","block","map","meta","line","callback","call","ruler","before","alt"],"mappings":"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"}